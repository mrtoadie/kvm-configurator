package ui

import (
	"fmt"
	"os"
)

// -------------------------------------------------------------------
// 1ï¸âƒ£  Farbcodes (wie du sie schon hast)
/*
const (
	Reset  = "\033[0m"
	Red    = "\033[31m"
	Yellow = "\033[33m"
	Green  = "\033[32m"
)
*/
// -------------------------------------------------------------------
// 2ï¸âƒ£  Kleine Struktur, die alles hÃ¤lt, was du brauchst
type UIError struct {
	Prefix string // z.â€¯B. "â—ï¸ Config fehlt"
	Colour string // Rot, Gelb â€¦ (kann leer bleiben â†’ keine Farbe)
	Err    error  // originaler Fehler, damit errors.Is/As weiter funktioniert
}

// Error erfÃ¼llt das builtâ€‘in errorâ€‘Interface
func (e *UIError) Error() string {
	msg := fmt.Sprintf("%s %v", e.Prefix, e.Err)
	if e.Colour != "" {
		return e.Colour + msg + Reset
	}
	return msg
}

// Unwrap ermÃ¶glicht errors.Is/As
func (e *UIError) Unwrap() error { return e.Err }

// -------------------------------------------------------------------
// 3ï¸âƒ£  Schnellâ€‘Factory â€“ du rufst nur diese eine Funktion auf
func NewUIError(colour, prefix string, ctx string, err error) error {
	if err == nil {
		return nil
	}
	// Kontextâ€‘Text wird zwischen Prefix und Originalâ€‘Error eingefÃ¼gt
	fullPrefix := fmt.Sprintf("%s %s", prefix, ctx)
	return &UIError{Prefix: fullPrefix, Colour: colour, Err: err}
}

// -------------------------------------------------------------------
// 4ï¸âƒ£  Convenienceâ€‘Wrapper fÃ¼r die gÃ¤ngigsten FÃ¤lle
func ConfigMissing(ctx string, err error) error {
	return NewUIError(Red, "â—ï¸ Configuration file not found", ctx, err)
}
func VirtInstallMissing(ctx string, err error) error {
	return NewUIError(Red, "ğŸš€ virtâ€‘install nicht gefunden", ctx, err)
}
func IsoNotFound(ctx string, err error) error {
	return NewUIError(Red, "ğŸ’¿ ISO nicht erreichbar", ctx, err)
}
func SelectionInvalid(ctx string, err error) error {
	return NewUIError(Yellow, "â“ UngÃ¼ltige Auswahl", ctx, err)
}

// -------------------------------------------------------------------
// 5ï¸âƒ£  Ausgabeâ€‘Hilfen (optional)
func Print(err error) {
	if err != nil {
		fmt.Fprintln(os.Stderr, err) // err already enthÃ¤lt Farbâ€‘Codes
	}
}
func Fatal(err error) {
	Print(err)
	os.Exit(1)
}